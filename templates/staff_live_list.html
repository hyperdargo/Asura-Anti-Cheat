{% extends 'base.html' %}
{% block title %}Staff Live Attempts{% endblock %}
{% block content %}
  <h2>Active Attempts</h2>
  <p>Only ongoing attempts (not finished) are shown. Click "Live Monitor" to join a student's live feed.</p>
  <p><a class="btn btn-outline-primary" href="{{ url_for('staff_live_all') }}">Global Live Feed</a></p>
  {% if attempts %}
    <table class="table table-sm">
      <thead><tr><th>#</th><th>Student</th><th>Exam</th><th>Started</th><th>Actions</th></tr></thead>
      <tbody>
        {% for a in attempts %}
          <tr>
            <td>{{ a.id }}</td>
            <td>{{ a.user.username if a.user else a.user_id }}</td>
            <td>{{ a.exam.title if a.exam else a.exam_id }}</td>
            <td>{{ a.started_at }}</td>
            <td>
              <a class="btn btn-sm btn-warning" href="{{ url_for('live_attempt_events', attempt_id=a.id) }}">Live Monitor</a>
              <a class="btn btn-sm btn-info" href="{{ url_for('view_attempt_events', attempt_id=a.id) }}">Full Log</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No active attempts found.</p>
  {% endif %}
{% endblock %}
