{% extends 'base.html' %}
{% block title %}Attempt Details{% endblock %}
{% block content %}
  <h2>Attempt by {{ attempt_user }}</h2>
  <p>
    <a class="btn btn-sm btn-outline-info" href="{{ url_for('view_attempt_events', attempt_id=attempt.id) }}">View Activity Log</a>
    {% if current_user.role in ['lecturer','staff','admin'] %}
      <a class="btn btn-sm btn-outline-warning" href="{{ url_for('live_attempt_events', attempt_id=attempt.id) }}">Live Monitor</a>
    {% endif %}
  </p>
  <p>Started: {{ attempt.started_at }} | Finished: {{ attempt.finished_at or 'In progress' }} | Score: {{ attempt.score if attempt.score is not none else '-' }}</p>

  <h4>Answers</h4>
  {% if answers %}
    {% for q in questions %}
      <div class="mb-3">
        <p><strong>Q{{ loop.index }}.</strong> {{ q.text }}</p>
        <ul>
          {% for choice in q.choices %}
            <li {% if loop.index0 == q.correct %}class="text-success"{% endif %}>
              {{ choice }} {% if answers[q.id|string] is not none and answers[q.id|string] == loop.index0 %}<strong>(selected)</strong>{% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  {% else %}
    <p>No answers recorded.</p>
  {% endif %}
  {% if can_mark %}
    <hr>
    <h4>Manual Marking</h4>
    <form method="post" action="{{ url_for('mark_attempt', attempt_id=attempt.id) }}">
      <div class="mb-3">
        <label class="form-label">Score (0-100)</label>
        <input class="form-control" name="score" value="{{ attempt.score if attempt.score is not none else '' }}">
      </div>
      <button class="btn btn-primary">Save Mark</button>
    </form>
  {% endif %}
{% endblock %}
