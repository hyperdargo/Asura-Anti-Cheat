<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Asura - Anti-Cheat Agent{% endblock %}</title>
    <link rel="icon" href="{{ url_for('image_file', filename='asura.png') }}" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Socket.IO Client for real-time features -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" crossorigin="anonymous"></script>
    <style>
      /* Professional Exam Portal Theme */
      @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap');
      
      * { box-sizing: border-box; }
      html, body { 
        height: 100%; 
        margin: 0; 
        padding: 0; 
        font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      }
      body { 
        display: flex; 
        flex-direction: column; 
        min-height: 100vh;
        background: linear-gradient(180deg, #1a237e 0%, #283593 50%, #3949ab 100%);
        background-attachment: fixed;
        color: #ffffff;
      }
      .app-main { flex: 1 0 auto; padding: 2rem 0; }
      footer.asura-footer { flex-shrink: 0; }

      /* Professional Color Palette for Exam Portal */
      :root {
        --primary-blue: #1e3a8a;
        --primary-blue-dark: #1e40af;
        --secondary-blue: #3b82f6;
        --accent-teal: #0891b2;
        --success: #059669;
        --warning: #d97706;
        --danger: #dc2626;
        --info: #0284c7;
        
        --surface: #ffffff;
        --surface-hover: #f8fafc;
        --text-primary: #ffffff;
        --text-secondary: #e2e8f0;
        --border: #cbd5e1;
        --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        --shadow-xl: 0 20px 25px rgba(0,0,0,0.12);
      }

      /* Top Security Banner */
      .navbar {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%) !important;
        box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3);
        padding: 1rem 0;
        border-bottom: 3px solid #3b82f6;
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.75rem;
        color: #ffffff !important;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: all 0.3s ease;
      }

      .navbar-brand img {
        filter: drop-shadow(0 2px 6px rgba(255, 255, 255, 0.3));
        transition: transform 0.3s ease;
      }

      .navbar-brand:hover img {
        transform: scale(1.1);
      }

      .navbar-brand span {
        position: relative;
        padding: 0.25rem 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .navbar-brand span::after {
        content: 'Anti-Cheat System';
        position: absolute;
        bottom: -1.5rem;
        left: 0;
        font-size: 0.65rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
        text-transform: uppercase;
        letter-spacing: 1px;
        white-space: nowrap;
      }

      .nav-link {
        font-weight: 500;
        color: rgba(255, 255, 255, 0.95) !important;
        padding: 0.5rem 1.25rem !important;
        margin: 0 0.25rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.15);
        color: #ffffff !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* Container */
      .container {
        max-width: 1280px;
      }

      /* Professional Cards for Exam Content */
      .card {
        background: #ffffff !important;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
        position: relative;
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #1e3a8a, #3b82f6, #0891b2);
        border-radius: 12px 12px 0 0;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        border-color: #3b82f6;
      }

      /* Professional Tables */
      .table {
        background: #ffffff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        border: 1px solid #e2e8f0;
      }

      .table thead th {
        background: linear-gradient(135deg, #1e3a8a, #1e40af);
        color: #ffffff !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.8px;
        padding: 1rem 1.25rem;
        border: none;
      }

      .table tbody tr {
        transition: all 0.2s ease;
        border-bottom: 1px solid #f1f5f9;
      }

      .table tbody tr:hover {
        background: #f8fafc !important;
        transform: scale(1.005);
      }

      .table tbody td {
        padding: 1rem 1.25rem;
        color: #334155 !important;
        border: none;
        font-size: 0.95rem;
      }

      .table-striped tbody tr:nth-of-type(odd) {
        background-color: #f8fafc !important;
      }

      /* Professional Buttons */
      .btn {
        font-weight: 600;
        border-radius: 8px;
        padding: 0.625rem 1.5rem;
        transition: all 0.3s ease;
        border: none;
        text-transform: uppercase;
        font-size: 0.875rem;
        letter-spacing: 0.5px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #1e3a8a, #1e40af);
        color: white;
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #1e40af, #2563eb);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(30, 58, 138, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #059669, #047857);
        color: white;
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
      }

      .btn-success:hover {
        background: linear-gradient(135deg, #047857, #065f46);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(5, 150, 105, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        color: white;
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #b91c1c, #991b1b);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
      }

      .btn-warning {
        background: linear-gradient(135deg, #d97706, #b45309);
        color: white;
        box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
      }

      .btn-warning:hover {
        background: linear-gradient(135deg, #b45309, #92400e);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(217, 119, 6, 0.4);
      }

      .btn-outline-secondary {
        border: 2px solid #cbd5e1;
        color: #475569;
        background: white;
      }

      .btn-outline-secondary:hover {
        background: #f8fafc;
        border-color: #94a3b8;
        color: #334155;
      }

      /* Professional Alerts for Exam Notifications */
      .alert {
        border-radius: 10px;
        border-left: 4px solid;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        animation: slideInDown 0.4s ease;
        background: white;
        color: #1e293b !important;
      }

      @keyframes slideInDown {
        from { opacity: 0; transform: translateY(-15px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .alert-success {
        border-left-color: #059669;
        background: #ecfdf5;
        color: #065f46;
      }

      .alert-danger {
        border-left-color: #dc2626;
        background: #fef2f2;
        color: #991b1b;
      }

      .alert-warning {
        border-left-color: #d97706;
        background: #fffbeb;
        color: #92400e;
      }

      .alert-info {
        border-left-color: #0284c7;
        background: #f0f9ff;
        color: #075985;
      }

      /* Form Controls for Exam Input */
      .form-control, .form-select {
        background: #ffffff;
        border: 2px solid #cbd5e1;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
        color: #1e293b;
        font-size: 1rem;
      }

      .form-control:focus, .form-select:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        outline: none;
      }

      .form-label {
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      label, p, span, div, small, em, strong {
        color: #ffffff;
      }

      .text-muted {
        color: rgba(255, 255, 255, 0.7) !important;
      }
      /* Professional Footer */
      footer.asura-footer {
        background: linear-gradient(135deg, #0f172a, #1e293b);
        border-top: 3px solid #3b82f6;
        padding: 2rem 0;
        margin-top: 4rem;
        color: rgba(255, 255, 255, 0.9);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      }

      footer.asura-footer strong {
        color: #ffffff;
        font-size: 1.1rem;
      }

      footer.asura-footer a {
        color: #60a5fa;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      footer.asura-footer a:hover {
        color: #93c5fd;
        text-decoration: underline;
      }

      /* Info Button */
      #brand-slider-toggle {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      #brand-slider-toggle:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: scale(1.05);
      }

      /* Badges for Exam Status */
      .badge {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge.bg-danger {
        background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
      }

      .badge.bg-success {
        background: linear-gradient(135deg, #059669, #047857) !important;
        box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
      }

      .badge.bg-warning {
        background: linear-gradient(135deg, #d97706, #b45309) !important;
        box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
      }

      .badge.bg-info {
        background: linear-gradient(135deg, #0284c7, #0369a1) !important;
        box-shadow: 0 2px 8px rgba(2, 132, 199, 0.3);
      }

      .badge.bg-secondary {
        background: linear-gradient(135deg, #64748b, #475569) !important;
        box-shadow: 0 2px 8px rgba(100, 116, 139, 0.3);
      }

      /* Brand Slider */
      .brand-slider {
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        z-index: 1050;
        transform: translateY(-110%);
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        background: linear-gradient(135deg, #1e3a8a, #1e40af);
        color: white;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .brand-slider[aria-hidden="false"] {
        transform: translateY(0%);
      }

      /* Headings */
      h1, h2, h3, h4, h5, h6 {
        font-weight: 700;
        color: #ffffff !important;
        margin-bottom: 1.5rem;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      h1 { font-size: 2.25rem; border-bottom: 3px solid #60a5fa; padding-bottom: 0.5rem; display: inline-block; }
      h2 { font-size: 1.875rem; }
      h3 { font-size: 1.5rem; }

      /* Page Title Banner */
      .page-header {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        border-left: 5px solid #3b82f6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      /* Security Indicator */
      .security-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(5, 150, 105, 0.1);
        color: #047857;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.85rem;
        border: 1px solid rgba(5, 150, 105, 0.3);
      }

      .security-badge::before {
        content: 'üîí';
        font-size: 1.2rem;
      }

      /* Smooth Animations */
      .fade-in {
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Loading States */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: #ffffff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
          <img src="{{ url_for('image_file', filename='asura.png') }}" alt="Asura" height="32" class="d-inline-block align-text-top me-2">
          <span>Asura</span>
        </a>
        <button id="brand-slider-toggle" class="btn btn-outline-secondary btn-sm me-2" aria-label="Open site menu">‚ÑπÔ∏è</button>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto">
            {% if current_user.is_authenticated %}
              <li class="nav-item"><span class="nav-link">{{ current_user.username }} ({{ current_user.role }})</span></li>
              {% if current_user.role == 'admin' %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_dashboard') }}">Admin</a></li>
              {% endif %}
              {% if current_user.role == 'lecturer' %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('teacher_exams') }}">Teacher</a></li>
              {% endif %}
              {% if current_user.role == 'student' %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('student_exams') }}">Exams</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('student_results') }}">Results</a></li>
              {% endif %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
            {% else %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">Login</a></li>
            {% endif %}
              {% if current_user.role == 'staff' %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('teacher_exams') }}">Teacher</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('staff_live_attempts') }}">Staff Live</a></li>
              {% endif %}
              {% if current_user.role == 'admin' %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('teacher_exams') }}">Teacher</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('staff_live_attempts') }}">Staff Live</a></li>
              {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <main class="app-main container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, msg in messages %}
            <div class="alert alert-{{ category }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <footer class="asura-footer bg-light mt-4">
      <div class="container d-flex justify-content-between align-items-center">
        <div>
          <strong>Asura</strong> ‚Äî Exam integrity tools &dash; &copy; DTEmpire
        </div>
        <div class="text-end">
          <a class="me-3" href="https://ankitgupta.com.np/" target="_blank" rel="noopener">About Me</a>
          <a class="me-3" href="https://linktr.ee/dargotamber" target="_blank" rel="noopener">linktr.ee</a>
          <span class="text-muted small">Built by DTEmpire</span>
        </div>
      </div>
    </footer>

    <!-- Sliding header banner (hidden by default) -->
    <div id="brand-slider" class="brand-slider" aria-hidden="true">
      <div class="brand-slider-inner container">
        <div class="d-flex justify-content-between align-items-center py-2">
          <div>
            <strong>Welcome to Asura</strong>
            <div class="small text-muted">Quick links & site notes</div>
          </div>
          <div>
            <button id="brand-slider-close" class="btn btn-sm btn-outline-light">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Site-wide interactions
        (function(){
            // Header slider toggle
            const sliderToggle = document.getElementById('brand-slider-toggle');
            const slider = document.getElementById('brand-slider');
            const sliderClose = document.getElementById('brand-slider-close');
            function openSlider(){ if(slider) slider.setAttribute('aria-hidden','false'); }
            function closeSlider(){ if(slider) slider.setAttribute('aria-hidden','true'); }
            if(sliderToggle && slider){
              sliderToggle.addEventListener('click', function(e){
                e.preventDefault();
                if(slider.getAttribute('aria-hidden') === 'false') closeSlider(); else openSlider();
              });
            }
            if(sliderClose) sliderClose.addEventListener('click', closeSlider);

          // Ripple effect for buttons
          function ripple(e){
            const el = e.currentTarget;
            const rect = el.getBoundingClientRect();
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
            ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
            el.appendChild(ripple);
            setTimeout(()=> ripple.remove(), 600);
          }
          document.querySelectorAll('button, .btn').forEach(it=>{
            it.style.position = it.style.position || 'relative';
            it.style.overflow = 'hidden';
            it.addEventListener('click', ripple);
          });

          // Scroll animations
          const io = new IntersectionObserver((entries)=>{
            entries.forEach(entry=>{
              if(entry.isIntersecting){ 
                entry.target.classList.add('fade-in'); 
              }
            });
          }, { threshold: 0.1 });
          document.querySelectorAll('.card, .table, .alert').forEach(el=> io.observe(el));
        })();

        // Ripple styles
        (function(){
          const style = document.createElement('style');
          style.textContent = `
            .ripple{ position:absolute; border-radius:50%; pointer-events:none; background: rgba(255,255,255,0.5); transform: scale(0); animation: rippleAnim .6s ease-out; }
            @keyframes rippleAnim{ to { transform: scale(2.5); opacity: 0; } }
          `;
          document.head.appendChild(style);
        })();
    </script>
  </body>
</html>
